"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.safeCompare = void 0;
var tslib_1 = require("tslib");
var ShopifyErrors = tslib_1.__importStar(require("../../error"));
function safeCompare(strA, strB) {
    if (typeof strA === typeof strB) {
        var enc = new TextEncoder();
        var buffA = enc.encode(JSON.stringify(strA));
        var buffB = enc.encode(JSON.stringify(strB));
        if (buffA.length === buffB.length) {
            return timingSafeEqual(buffA, buffB);
        }
    }
    else {
        throw new ShopifyErrors.SafeCompareError("Mismatched data types provided: ".concat(typeof strA, " and ").concat(typeof strB));
    }
    return false;
}
exports.safeCompare = safeCompare;
// Buffer must be same length for this function to be secure.
function timingSafeEqual(bufA, bufB) {
    var viewA = new Uint8Array(bufA);
    var viewB = new Uint8Array(bufB);
    var out = 0;
    for (var i = 0; i < viewA.length; i++) {
        out |= viewA[i] ^ viewB[i];
    }
    return out === 0;
}
//# sourceMappingURL=safe-compare.js.map